@(deployRecords:Either[Throwable, List[(String,Map[String,deployment.Record])]])

@deployRecords match {
    case Left(t) => {
        <div class="alert alert-error"><strong>Could not fetch deploys:</strong> @t.getMessage</div>
        <pre>@t.printStackTrace</pre>
    }
    
    case Right(rs) => {
        @defining(rs.flatMap(_._2.values).map(_.stage.name).distinct.sorted(conf.Configuration.stages.ordering)) { stages =>
            <table class="table">
            <thead>
                <tr>
                    <th>Project</th>
                    @stages.map{ stage =>
                        <th>@stage</th>
                    }
                </tr>
            </thead>
            <tbody>
            @for((project,stageRecordMap) <- rs) {
                <tr>
                    <td>@project</td>
                    @stages.map{ stage =>
                        <td>
                        @stageRecordMap.get(stage).map{ r => @snippets.pimpedBuildId(r) }
                        </td>
                    }
                </tr>
            }
            </tbody>
            </table>
        }
    }

}
